<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïø†ÎßàÎãπÍ≥†</title>
    <!-- Ìè∞Ìä∏ (ÌÉÄÏù¥ÌãÄÎßå Ï†ÅÏö©) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gasoek+One&display=swap" rel="stylesheet">
    <!-- Í∏∞ÌÉÄ Ìè∞Ìä∏ Î∞è Ïä§ÌÉÄÏùº -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/suit-font@1.0.0/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable-jp.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'SUIT', 'Pretendard Variable', 'Noto Sans KR', 'Malgun Gothic', Arial, sans-serif;
            background: #fffbe0;
            margin: 0;
            padding: 0;
        }
        .main-wrapper {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
        }
        .home-btn {
            position: absolute;
            left: 12px;
            top: 15px;
            background: none;
            border: none;
            cursor: pointer;
            width: 32px;
            height: 32px;
            padding: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .home-icon {
            width: 22px;
            height: 22px;
            display: block;
            color: #6b430c;
            fill: #6b430c;
            transition: color 0.13s, fill 0.13s;
        }
        .home-btn:hover .home-icon {
            color: #b57c2a;
            fill: #b57c2a;
        }
        .kuma-title {
            margin-top: 46px;
            margin-bottom: 20px;
            font-size: 2.7rem;
 		 font-family: "Gasoek One", sans-serif;
  		font-style: normal;
            color: #926c37;
            font-weight: 400;
            letter-spacing: 0.08em;
            text-align: center;
            text-shadow: 2px 3px 0 #ffeec1, 0 0 8px #fff8ec;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 18px;
        }
        .kuma-emoji {
            font-size: 2.4rem;
            vertical-align: middle;
            margin-right: 0px;
        }
        .dango-emoji {
            font-size: 2.1rem;
            vertical-align: middle;
            margin-left: 0px;
        }
        .level-bar {
            margin-top: 8px;
            margin-bottom: 8px;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }
        .level-label {
            color: #a16e0f;
            font-size: 1.08rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }
        .level-select {
            font-size: 1.08rem;
            border-radius: 12px;
            border: 2px solid #ffe6bc;
            padding: 7px 16px 7px 10px;
            background: #fff8ef;
            color: #a16e0f;
            font-family: inherit;
            cursor: pointer;
            font-weight: 500;
            transition: border 0.13s, color 0.13s, background 0.13s;
        }
        .vertical-tab-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
            margin: 70px 0 0 0;
            width: 220px;
            position: relative;
        }
        .vertical-tab-btn {
            width: 100%;
            font-family:'Cafe24SsurroundAir', 'UhBee zzibae', 'SUIT', 'Pretendard Variable', 'Noto Sans KR', sans-serif;
            background: #fff;
            border: 2.5px solid #ffe6bc;
            color: #a16e0f;
            font-size: 1.35rem;
            font-weight: 700;
            border-radius: 18px;
            padding: 24px 0;
            cursor: pointer;
            box-shadow: 0 1.5px 8px #ffe6bc63;
            letter-spacing: 0.06em;
            transition: background .18s, color .16s, border .18s, box-shadow .17s;
            margin: 0;
        }
        .vertical-tab-btn.active {
            background: #ffe6bc;
            color: #f06a6a;
            border: 2.5px solid #f06a6a;
            box-shadow: 0 3px 12px #ffe6bc7c;
        }
        .vertical-tab-btn:active {
            background: #ffd6b0;
        }
        .card-area {
            width: 340px;
            background: #fff6f9;
            border-radius: 28px;
            box-shadow: 0 6px 32px rgba(255, 188, 197, 0.16), 0 1.5px 6px #ffe6bc;
            padding: 33px 22px 22px 22px;
            margin-bottom: 32px;
            display: none;
            flex-direction: column;
            align-items: center;
            position: relative;
            justify-content: center;
            border: 3.5px solid #ffe6bc;
        }
        .speak-btn, .example-speak-btn {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            font-size: 1.9rem;
            color: #e7a162;
            z-index: 2;
            transition: color 0.15s;
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
        }
        .speak-btn { position: absolute; top: 15px; right: 15px; font-size: 1.9rem; }
        .speak-btn:hover, .example-speak-btn:hover { color: #f06a6a; }
        .speak-btn.active, .example-speak-btn.active { color: #ff6b29 !important; }
        .speaker-wave {
            display: flex;
            align-items: flex-end;
            gap: 1.5px;
            margin-left: 5px;
            height: 18px;
        }
        .wave-bar { width: 3px; height: 7px; background: #ffb97a; border-radius: 2px; opacity: 0.85; animation: wave 0.9s infinite; transform-origin: bottom;}
        .wave-bar:nth-child(2) { animation-delay: 0.18s;}
        .wave-bar:nth-child(3) { animation-delay: 0.36s;}
        @keyframes wave { 0%{height:7px;} 20%{height:17px;} 40%{height:7px;} 60%{height:15px;} 80%{height:7px;} 100%{height:7px;}}
        .speaker-wave { visibility: hidden; }
        .speak-btn.active .speaker-wave,
        .example-speak-btn.active .speaker-wave { visibility: visible; }
        .example-speak-btn .speaker-wave { height: 14px; margin-left: 5px; }
        .example-speak-btn .wave-bar { width: 2px; border-radius: 1.5px; }
        .jp-word {
            font-size: 2.2rem;
            color: #7d5f3b;
            font-weight: 800;
            cursor: pointer;
            user-select: none;
            margin-bottom: 7px;
            margin-top: 6px;
            text-align: center;
            letter-spacing: 0.06em;
            width: 100%;
            border-radius: 12px;
            padding: 2px 0;
            transition: background 0.15s;
        }
        .jp-word:hover {
            background: #fffbe0;
        }
        .yomigana {
            font-size: 1.12rem;
            color: #e7a162;
            margin-bottom: 10px;
            min-height: 1.5em;
            transition: opacity 0.2s;
            opacity: 0;
            pointer-events: none;
            text-align: center;
            width: 100%;
        }
        .show-yomigana { opacity: 1 !important; pointer-events: auto; animation: fade-in 0.25s;}
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        .meaning-btn {
            margin-top: 10px;
            padding: 9px 32px 9px 32px;
            border: none;
            background: #ffe6bc;
            color: #7d5f3b;
            border-radius: 18px;
            font-size: 1.13rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 1.5px 5px #ffe6bc7a;
            letter-spacing: 0.06em;
            transition: background 0.19s, color 0.17s;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .meaning-btn:hover { background: #ffd6b0; color: #f06a6a; }
        .meaning-box {
            background: #fffbe7;
            color: #7d5f3b;
            margin-top: 25px;
            border-radius: 18px;
            padding: 18px 10px 13px 10px;
            width: 100%;
            font-size: 1.14rem;
            box-shadow: 0 0.5px 5px #ffe6bc66;
            word-break: keep-all;
            text-align: center;
            transition: opacity 0.25s;
            position: relative;
            border: 1.7px solid #ffd6b0;
        }
        .example-jp {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #926c37;
            font-size: 1.04rem;
            margin-top: 15px;
            margin-bottom: 3px;
            font-weight: bold;
            text-align: center;
            gap: 6px;
        }
        .example-kr {
            display: block;
            color: #a8a6a5;
            font-size: 1.01rem;
            margin-bottom: 2px;
            text-align: center;
        }
        .btn-group {
            display: flex;
            gap: 14px;
            justify-content: center;
            margin-top: 6px;
        }
        .review-btn {
            padding: 10px 24px;
            background: #fffbe0;
            color: #a16e0f;
            border: 2px solid #ffe6bc;
            border-radius: 18px;
            font-size: 1.02rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.17s, color 0.16s, border 0.17s;
            box-shadow: 0 1.5px 5px #ffe6bc4a;
        }
        .review-btn.active,
        .review-btn.selected {
            background: #ffe6bc;
            color: #f06a6a;
            border: 2px solid #f06a6a;
        }
        .review-btn:active {
            background: #ffd6b0;
        }
        .next-btn {
            padding: 11px 40px;
            border: none;
            background: #ffe6bc;
            color: #7d5f3b;
            border-radius: 18px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 1.5px 5px #ffe6bc7a;
            letter-spacing: 0.06em;
            transition: background 0.18s, color 0.16s;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .next-btn:hover {
            background: #ffd6b0;
            color: #f06a6a;
        }
        .know-btn {
            padding: 10px 24px;
            background: #d9f5d3;
            color: #2d7d2c;
            border: 2px solid #b4e5ae;
            border-radius: 18px;
            font-size: 1.02rem;
            font-weight: 700;
            cursor: pointer;
            margin-left: 8px;
            transition: background 0.15s, color 0.13s, border 0.14s;
        }
        .know-btn:hover {
            background: #b4e5ae;
            color: #1f5e1d;
        }
        .quiz-answer-input {
            margin: 20px auto 8px auto;
            padding: 12px 16px;
            font-size: 1.1rem;
            border-radius: 14px;
            border: 2px solid #ffe6bc;
            background: #fffbe7;
            color: #7d5f3b;
            outline: none;
            width: 85%;
            box-sizing: border-box;
            text-align: center;
            font-family: inherit;
        }
        .quiz-input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
            width: 100%;
        }
        .quiz-check-btn {
            padding: 9px 22px;
            background: #ffe6bc;
            color: #7d5f3b;
            border: none;
            border-radius: 14px;
            font-size: 1.08rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 1.5px 5px #ffe6bc7a;
            letter-spacing: 0.04em;
            transition: background 0.18s, color 0.16s;
        }
        .quiz-check-btn:hover {
            background: #ffd6b0;
            color: #f06a6a;
        }
        .quiz-btn-group {
            display: flex;
            justify-content: center;
            gap: 14px;
            margin-top: 8px;
        }
        .quiz-result-msg {
            font-size: 1.13rem;
            text-align: center;
            margin: 10px 0 4px 0;
            color: #f06a6a;
            font-weight: bold;
        }
        .review-list {
            margin: 24px auto 0 auto;
            padding: 20px 16px 10px 16px;
            border-radius: 18px;
            background: #fffdf2;
            border: 2px solid #ffe6bc;
            max-width: 400px;
            box-shadow: 0 2px 12px #ffe6bc47;
        }
        .review-list-title {
            font-size: 1.17rem;
            font-weight: bold;
            color: #926c37;
            margin-bottom: 12px;
        }
        .review-list-ul {
            list-style: none;
            padding: 0 0 0 0;
            margin: 0;
        }
        .review-list-li {
            padding: 7px 0;
            border-bottom: 1px dashed #ffe6bc;
            font-size: 1.07rem;
            color: #7d5f3b;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .review-list-li:last-child {
            border-bottom: none;
        }
        .review-jp {
            font-weight: bold;
            font-size: 1.13rem;
            color: #a16e0f;
        }
        .review-kr {
            color: #a8a6a5;
            font-size: 0.94rem;
        }
        .card-idx-indicator {
            margin-top: 8px;
            font-size: 1.05rem;
            color: #d3ac6f;
            letter-spacing: 1px;
            text-align: center;
        }
        .result-msg {
            margin: 32px 0 0 0;
            font-size: 1.25rem;
            color: #a16e0f;
            font-weight: 700;
            text-align: center;
            background: #fffbe0;
            padding: 24px 16px;
            border-radius: 20px;
            border: 2px solid #ffe6bc;
        }
        .goto-home-btn {
            padding: 8px 30px;
            background: #fff;
            color: #a16e0f;
            border: 2px solid #ffe6bc;
            border-radius: 18px;
            font-size: 1.11rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 24px;
            margin-bottom: 8px;
            box-shadow: 0 1.5px 5px #ffe6bc4a;
            transition: background 0.17s, color 0.16s, border 0.17s;
        }
        .goto-home-btn:hover {
            background: #ffe6bc;
            color: #f06a6a;
            border: 2px solid #f06a6a;
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <button class="home-btn" id="home-btn" title="ÌôàÏúºÎ°ú" aria-label="ÌôàÏúºÎ°ú">
            <svg class="home-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 4.4L4 11.07V20a1 1 0 0 0 1 1h5.5V15h3v6H19a1 1 0 0 0 1-1v-8.93L12 4.4z"/>
            </svg>
        </button>
        <div class="kuma-title">
            <span class="kuma-emoji">üêª</span>
            Ïø†ÎßàÎãπÍ≥†
            <span class="dango-emoji">üç°</span>
        </div>
        <!-- Î†àÎ≤® ÏÑ†ÌÉù Î∞î -->
        <div class="level-bar">
            <span class="level-label">Î†àÎ≤®</span>
            <select id="level-select" class="level-select" onchange="onLevelChange(this.value)">
                <option value="n5" selected>N5</option>
                <option value="n4">N4</option>
                <option value="n3">N3</option>
                <option value="n2">N2</option>
                <option value="n1">N1</option>
            </select>
        </div>
        <div class="vertical-tab-bar" id="vertical-tab-bar">
            <button class="vertical-tab-btn" id="vtab-main" onclick="selectHomeTab('main')">Îã®Ïñ¥ ÌïôÏäµ</button>
            <button class="vertical-tab-btn" id="vtab-review" onclick="selectHomeTab('review')">Î≥µÏäµ</button>
            <button class="vertical-tab-btn" id="vtab-quiz" onclick="selectHomeTab('quiz')">ÌÄ¥Ï¶à</button>
        </div>
        <div class="card-area" id="card-area" style="display:none;"></div>
        <div class="card-idx-indicator" id="card-indicator"></div>
        <div class="btn-group" id="btn-group">
            <button class="review-btn" id="review-btn" onclick="markForReview()">Î≥µÏäµ</button>
            <button class="next-btn" id="next-btn" onclick="showNextCard()">Îã§Ïùå</button>
        </div>
        <div class="btn-group" id="review-btn-group" style="display:none;">
            <button class="review-btn" id="review-again-btn" onclick="reviewAgain()">Î≥µÏäµ</button>
            <button class="know-btn" id="review-know-btn" onclick="reviewKnow()">Ïô∏Ïõ†Ïñ¥Ïöî!</button>
        </div>
        <div class="quiz-btn-group" id="quiz-btn-group" style="display:none;">
            <button class="next-btn" id="quiz-next-btn" onclick="quizNext()">Îã§Ïùå</button>
            <button class="next-btn" id="quiz-show-btn" onclick="quizShowAnswer()">Ï†ïÎãµ Î≥¥Í∏∞</button>
        </div>
        <div class="quiz-result-msg" id="quiz-result-msg" style="display:none;"></div>
        <div class="result-msg" id="result-msg" style="display:none;"></div>
        <div class="review-list" id="review-list" style="display:none;"></div>
    </div>
    <script>
        // Î†àÎ≤®Î≥Ñ Îã®Ïñ¥Ïû• Îç∞Ïù¥ÌÑ∞ (ÏòàÏãú)
        const WORDS_BY_LEVEL = {
            n5: [
                {jp: "Â≠¶Ê†°", yomigana: "„Åå„Å£„Åì„ÅÜ", kr: "ÌïôÍµê", example_jp: "ÁßÅ„ÅØÊØéÊó•Â≠¶Ê†°„Å´Ë°å„Åç„Åæ„Åô.", example_kr: "ÎÇòÎäî Îß§Ïùº ÌïôÍµêÏóê Í∞ëÎãàÎã§."},
                {jp: "ÂèãÈÅî", yomigana: "„Å®„ÇÇ„Å†„Å°", kr: "ÏπúÍµ¨", example_jp: "ÂèãÈÅî„Å®Êò†Áîª„ÇíË¶ã„Å´Ë°å„Åç„Åæ„Åó„Åü.", example_kr: "ÏπúÍµ¨ÏôÄ ÏòÅÌôîÎ•º Î≥¥Îü¨ Í∞îÏñ¥Ïöî."},
                {jp: "ÂãâÂº∑", yomigana: "„Åπ„Çì„Åç„Çá„ÅÜ", kr: "Í≥µÎ∂Ä", example_jp: "‰ªäÊó•„ÇÇ„Åü„Åè„Åï„ÇìÂãâÂº∑„Åó„Åæ„Åó„Åü.", example_kr: "Ïò§ÎäòÎèÑ ÎßéÏù¥ Í≥µÎ∂ÄÌñàÏäµÎãàÎã§."},
                {jp: "ÂÖàÁîü", yomigana: "„Åõ„Çì„Åõ„ÅÑ", kr: "ÏÑ†ÏÉùÎãò", example_jp: "ÂÖàÁîü„ÅåÊñ∞„Åó„ÅÑÊú¨„Çí„Åè„Çå„Åæ„Åó„Åü.", example_kr: "ÏÑ†ÏÉùÎãòÏù¥ ÏÉà Ï±ÖÏùÑ Ï£ºÏÖ®Ïñ¥Ïöî."},
                {jp: "Êú¨", yomigana: "„Åª„Çì", kr: "Ï±Ö", example_jp: "„Åì„ÅÆÊú¨„ÅØ„Å®„Å¶„ÇÇÈù¢ÁôΩ„ÅÑ„Åß„Åô.", example_kr: "Ïù¥ Ï±ÖÏùÄ Îß§Ïö∞ Ïû¨ÎØ∏ÏûàÏñ¥Ïöî."}
            ],
            n4: [
                {jp: "ÂøÖË¶Å", yomigana: "„Å≤„Å§„Çà„ÅÜ", kr: "ÌïÑÏöî", example_jp: "„Éë„Çπ„Éù„Éº„Éà„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ", example_kr: "Ïó¨Í∂åÏù¥ ÌïÑÏöîÌï©ÎãàÎã§."},
                {jp: "ÁµåÈ®ì", yomigana: "„Åë„ÅÑ„Åë„Çì", kr: "Í≤ΩÌóò", example_jp: "Â§ö„Åè„ÅÆÁµåÈ®ì„ÇíÁ©ç„Åø„Åæ„Åó„Åü„ÄÇ", example_kr: "ÎßéÏùÄ Í≤ΩÌóòÏùÑ ÏåìÏïòÏäµÎãàÎã§."}
            ],
            n3: [
                {jp: "ÁêÜËß£", yomigana: "„Çä„Åã„ÅÑ", kr: "Ïù¥Ìï¥", example_jp: "ÂΩº„ÅÆË™¨Êòé„ÅØÁêÜËß£„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ", example_kr: "Í∑∏Ïùò ÏÑ§Î™ÖÏùÄ Ïù¥Ìï¥Ìï† Ïàò ÏóÜÏóàÏäµÎãàÎã§."}
            ],
            n2: [
                {jp: "ÂØæÂøú", yomigana: "„Åü„ÅÑ„Åä„ÅÜ", kr: "ÎåÄÏùë", example_jp: "ËøÖÈÄü„Å™ÂØæÂøú„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ", example_kr: "Ïã†ÏÜçÌïú ÎåÄÏùë Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§."}
            ],
            n1: [
                {jp: "ÊäΩË±°Ï†Å", yomigana: "„Å°„ÇÖ„ÅÜ„Åó„Çá„ÅÜ„Å¶„Åç", kr: "Ï∂îÏÉÅÏ†Å", example_jp: "ÊäΩË±°ÁöÑ„Å™Ë°®Áèæ„ÅØÈõ£„Åó„ÅÑ„Åß„Åô„ÄÇ", example_kr: "Ï∂îÏÉÅÏ†ÅÏù∏ ÌëúÌòÑÏùÄ Ïñ¥Î†µÏäµÎãàÎã§."}
            ]
        };

        let currentLevel = "n5";
        let words = [...WORDS_BY_LEVEL[currentLevel]];

        function setWordsByLevel(level) {
            words = [...(WORDS_BY_LEVEL[level] || [])];
        }

        function onLevelChange(level) {
            currentLevel = level;
            setWordsByLevel(level);
            mainWords = shuffle(words);
            reviewWords = [];
            quizWords = [];
            allReviewedWords = [];
            mode = "";
            currentIdx = 0;
            reviewSet = new Set();
            finished = false;
            quizShowedAnswer = false;
            document.getElementById('card-area').style.display = "none";
            document.getElementById('btn-group').style.display = "none";
            document.getElementById('review-btn-group').style.display = "none";
            document.getElementById('quiz-btn-group').style.display = "none";
            document.getElementById('quiz-result-msg').style.display = "none";
            document.getElementById('card-indicator').textContent = "";
            setActiveHomeTab();
        }

        function shuffle(array) {
            let arr = [...array];
            let m = arr.length, t, i;
            while (m) {
                i = Math.floor(Math.random() * m--);
                t = arr[m];
                arr[m] = arr[i];
                arr[i] = t;
            }
            return arr;
        }

        let mainWords = shuffle(words);
        let reviewWords = [];
        let quizWords = [];
        let allReviewedWords = [];
        let mode = "";
        let currentIdx = 0;
        let reviewSet = new Set();
        let finished = false;
        let quizShowedAnswer = false;

        function goHome() {
            document.getElementById('review-list').style.display = "none";
            document.getElementById('result-msg').style.display = "none";
            document.getElementById('btn-group').style.display = "none";
            document.getElementById('review-btn-group').style.display = "none";
            document.getElementById('quiz-btn-group').style.display = "none";
            document.getElementById('quiz-result-msg').style.display = "none";
            document.getElementById('vertical-tab-bar').style.display = "flex";
            mainWords = shuffle(words);
            reviewWords = [];
            quizWords = [];
            mode = "";
            currentIdx = 0;
            finished = false;
            document.getElementById('card-area').style.display = "none";
            document.getElementById('card-indicator').textContent = "";
            setActiveHomeTab();
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('home-btn').addEventListener('click', goHome);
            goHome();
        });

        function setActiveHomeTab(tab) {
            let main = document.getElementById('vtab-main');
            let review = document.getElementById('vtab-review');
            let quiz = document.getElementById('vtab-quiz');
            main.classList.toggle('active', tab === 'main');
            review.classList.toggle('active', tab === 'review');
            quiz.classList.toggle('active', tab === 'quiz');
        }

        function selectHomeTab(tab) {
            setActiveHomeTab(tab);
            document.getElementById('vertical-tab-bar').style.display = "none";
            document.getElementById('card-area').style.display = "flex";
            if (tab === 'main') {
                mode = "main";
                mainWords = shuffle(words);
                currentIdx = 0;
                finished = false;
                renderCard(currentIdx);
                document.getElementById('btn-group').style.display = "flex";
                document.getElementById('review-btn-group').style.display = "none";
                document.getElementById('quiz-btn-group').style.display = "none";
                document.getElementById('quiz-result-msg').style.display = "none";
            } else if (tab === 'review') {
                mode = "review";
                let uniq = [];
                let seen = new Set();
                for (const w of allReviewedWords) {
                    if (!seen.has(w.jp)) {
                        uniq.push(w);
                        seen.add(w.jp);
                    }
                }
                reviewWords = uniq.length > 0 ? uniq : [];
                currentIdx = 0;
                finished = false;
                if (reviewWords.length === 0) {
                    document.getElementById('card-area').innerHTML = `
                      <div style="font-size:1.17rem;margin:70px 0 35px 0;text-align:center;color:#a16e0f;font-family:'Cafe24SsurroundAir','UhBee zzibae',sans-serif;">
                        Î≥µÏäµÌïú Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§.
                      </div>
                    `;
                    document.getElementById('btn-group').style.display = "none";
                    document.getElementById('review-btn-group').style.display = "none";
                    document.getElementById('quiz-btn-group').style.display = "none";
                    document.getElementById('card-indicator').textContent = "";
                    return;
                }
                renderReviewList();
            } else if (tab === 'quiz') {
                mode = "quiz";
                quizWords = shuffle(words);
                currentIdx = 0;
                quizShowedAnswer = false;
                renderQuizCard(currentIdx);
                document.getElementById('btn-group').style.display = "none";
                document.getElementById('review-btn-group').style.display = "none";
                document.getElementById('quiz-btn-group').style.display = "flex";
                document.getElementById('quiz-result-msg').style.display = "none";
            }
        }

        function renderReviewList() {
            let w = reviewWords[currentIdx];
            let total = reviewWords.length;
            let shownIdx = currentIdx + 1;
            document.getElementById('card-area').innerHTML = `
                <div class="jp-word" onclick="toggleYomigana(this)" style="margin-bottom:10px;">${w.jp}</div>
                <div class="yomigana" style="margin-bottom:13px;">${w.yomigana}</div>
                <div class="meaning-box" style="margin-bottom:12px;">
                    <div><b>Îúª:</b> ${w.kr}</div>
                    <span class="example-jp" style="margin-top:10px;">
                        ${w.example_jp}
                    </span>
                    <span class="example-kr">${w.example_kr}</span>
                </div>
                <div class="card-idx-indicator">${shownIdx} / ${total}</div>
                <div class="quiz-btn-group" style="margin-top:12px;">
                    <button class="next-btn" onclick="reviewListPrev()">Ïù¥Ï†Ñ</button>
                    <button class="next-btn" onclick="reviewListNext()">Îã§Ïùå</button>
                </div>
            `;
        }
        window.reviewListPrev = function() {
            if (currentIdx > 0) currentIdx--;
            else currentIdx = reviewWords.length - 1;
            renderReviewList();
        }
        window.reviewListNext = function() {
            if (currentIdx < reviewWords.length - 1) currentIdx++;
            else currentIdx = 0;
            renderReviewList();
        }

        function speakJapanese(text, btn) {
            const synth = window.speechSynthesis;
            if (synth.speaking) synth.cancel();
            btn.classList.add('active');
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'ja-JP';
            utter.rate = 1.0;
            utter.onend = utter.onerror = function() {
                if(btn) btn.classList.remove('active');
            };
            synth.speak(utter);
        }

        function renderCard(idx) {
            let word = mainWords[idx];
            let total = mainWords.length;
            let shownIdx = idx + 1;
            const cardArea = document.getElementById('card-area');
            cardArea.innerHTML = `
                <button class="speak-btn" onclick="speakJapanese('${word.jp}', this)" aria-label="Î∞úÏùå Îì£Í∏∞">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="display:inline-block;vertical-align:middle;">
                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1-3.29-2.5-4.03v8.06c1.5-.74 2.5-2.26 2.5-4.03z" fill="currentColor"/>
                        <path d="M14.5 3.97v2.06C17.09 7.36 19 10.07 19 13s-1.91 5.64-4.5 6.97v2.06c4.01-1.25 7-4.97 7-9.03s-2.99-7.78-7-9.03z" fill="currentColor"/>
                    </svg>
                    <span class="speaker-wave">
                        <span class="wave-bar"></span>
                        <span class="wave-bar"></span>
                        <span class="wave-bar"></span>
                    </span>
                </button>
                <div class="jp-word" onclick="toggleYomigana(this)">${word.jp}</div>
                <div class="yomigana">${word.yomigana}</div>
                <button class="meaning-btn" onclick="showMeaning()">Îúª Î≥¥Í∏∞</button>
                <div class="meaning-box" id="meaning-box" style="display:none;">
                    <div><b>Îúª:</b> ${word.kr}</div>
                    <span class="example-jp">
                        ${word.example_jp}
                        <button class="example-speak-btn" onclick="speakJapanese('${word.example_jp}', this)" title="ÏòàÎ¨∏ Îì£Í∏∞" aria-label="ÏòàÎ¨∏ Îì£Í∏∞">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:inline-block;vertical-align:middle;">
                                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1-3.29-2.5-4.03v8.06c1.5-.74 2.5-2.26 2.5-4.03z" fill="currentColor"/>
                                <path d="M14.5 3.97v2.06C17.09 7.36 19 10.07 19 13s-1.91 5.64-4.5 6.97v2.06c4.01-1.25 7-4.97 7-9.03s-2.99-7.78-7-9.03z" fill="currentColor"/>
                            </svg>
                            <span class="speaker-wave">
                                <span class="wave-bar"></span>
                                <span class="wave-bar"></span>
                                <span class="wave-bar"></span>
                            </span>
                        </button>
                    </span>
                    <span class="example-kr">${word.example_kr}</span>
                </div>
            `;
            document.getElementById('card-indicator').textContent = `${shownIdx} / ${total}`;
            document.getElementById('btn-group').style.display = "flex";
            document.getElementById('review-btn-group').style.display = "none";
            document.getElementById('quiz-btn-group').style.display = "none";
            document.getElementById('review-btn').classList.toggle('selected', reviewSet.has(word.jp));
            document.getElementById('review-btn').disabled = false;
            document.getElementById('next-btn').textContent = (shownIdx === total) ? "ÎÅùÎÇ¥Í∏∞" : "Îã§Ïùå";
            document.getElementById('result-msg').style.display = "none";
            document.getElementById('review-list').style.display = "none";
            document.getElementById('quiz-result-msg').style.display = "none";
        }

        function markForReview() {
            if (mode === "main") {
                let word = mainWords[currentIdx];
                reviewSet.add(word.jp);
                showNextCard();
            }
        }

        function showMeaning() {
            document.querySelector('.meaning-btn').style.display = 'none';
            document.getElementById('meaning-box').style.display = 'block';
        }

        function showNextCard() {
            if (mode === "main") {
                if (currentIdx < mainWords.length - 1) {
                    currentIdx++;
                    renderCard(currentIdx);
                } else {
                    finishMain();
                }
            }
        }

        function finishMain() {
            let reviewedNow = mainWords.filter(w => reviewSet.has(w.jp));
            for(const w of reviewedNow) {
                if (!allReviewedWords.some(x=>x.jp===w.jp)) allReviewedWords.push(w);
            }
            document.getElementById('card-area').innerHTML = `
                <div style="font-size:1.3rem;margin:70px 0 20px 0;text-align:center;color:#a16e0f;font-family:'Cafe24SsurroundAir','UhBee zzibae',sans-serif;">
                    Î™®Îì† Îã®Ïñ¥Î•º ÌïôÏäµ ÏôÑÎ£åÌñàÏñ¥Ïöî! üéâ
                </div>
                <button class="goto-home-btn" onclick="goHome()">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
            `;
            document.getElementById('card-indicator').textContent = "";
            document.getElementById('btn-group').style.display = "none";
        }

        // ----------- ÌÄ¥Ï¶à Î™®Îìú -----------
        function renderQuizCard(idx) {
            let word = quizWords[idx];
            let total = quizWords.length;
            let shownIdx = idx + 1;
            quizShowedAnswer = false;
            let blank = "ÔºøÔºøÔºø";
            let quizExample = word.example_jp.replaceAll(word.jp, blank);
            const cardArea = document.getElementById('card-area');
            cardArea.innerHTML = `
                <div style="font-size:1.19rem;margin-bottom:18px;text-align:center;color:#926c37;">
                    <b>ÎπàÏπ∏Ïóê Îì§Ïñ¥Í∞à Îã®Ïñ¥Î•º ÎßûÌòÄÎ≥¥ÏÑ∏Ïöî!</b>
                </div>
                <div class="example-jp" style="font-size:1.22rem; margin-bottom:6px;">
                    ${quizExample}
                </div>
                <div class="example-kr" style="margin-bottom:8px;color:#a8a6a5;font-size:1.05rem;">${word.example_kr}</div>
                <div class="quiz-input-group">
                    <input type="text" class="quiz-answer-input" id="quiz-answer-input" autocomplete="off"
                        placeholder="Ï†ïÎãµÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeydown="if(event.key==='Enter'){quizCheckAnswer();}">
                    <button class="quiz-check-btn" onclick="quizCheckAnswer()">Ï†ïÎãµ ÌôïÏù∏</button>
                </div>
                <div class="quiz-result-msg" id="quiz-result-msg" style="display:none;"></div>
                <div class="card-idx-indicator" style="margin-top:16px;">${shownIdx} / ${total}</div>
            `;
            document.getElementById('quiz-btn-group').style.display = "flex";
            document.getElementById('quiz-next-btn').disabled = false;
            document.getElementById('quiz-show-btn').disabled = false;
            // ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî Î∞è Ìè¨Ïª§Ïä§
            setTimeout(() => {
                if(document.getElementById('quiz-answer-input')) {
                    document.getElementById('quiz-answer-input').value = "";
                    document.getElementById('quiz-answer-input').focus();
                }
            }, 0);
            // Í≤∞Í≥º Î©îÏãúÏßÄ Ïà®ÍπÄ
            document.getElementById('quiz-result-msg').style.display = "none";
        }

        function quizCheckAnswer() {
            const input = document.getElementById('quiz-answer-input');
            if (!input) return;
            const userAns = input.value.trim();
            let word = quizWords[currentIdx];
            const answer = word.jp.trim();
            const resultMsg = document.getElementById('quiz-result-msg');
            if (userAns === "") {
                resultMsg.textContent = "Ï†ïÎãµÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî.";
                resultMsg.style.color = "#f06a6a";
                resultMsg.style.display = "block";
                return;
            }
            if (userAns === answer) {
                resultMsg.textContent = "Ï†ïÎãµÏûÖÎãàÎã§! üêªüç°";
                resultMsg.style.color = "#2d7d2c";
            } else {
                resultMsg.textContent = "ÏïÑÏâΩÏßÄÎßå Ïò§ÎãµÏù¥ÏóêÏöî!";
                resultMsg.style.color = "#f06a6a";
            }
            resultMsg.style.display = "block";
            quizShowedAnswer = false;
        }

        function quizShowAnswer() {
            let word = quizWords[currentIdx];
            const resultMsg = document.getElementById('quiz-result-msg');
            resultMsg.innerHTML = `<b>Ï†ïÎãµ: ${word.jp}</b><br><span style="color:#a8a6a5;font-size:0.98rem;">Îúª: ${word.kr}</span>`;
            resultMsg.style.color = "#7d5f3b";
            resultMsg.style.display = "block";
            quizShowedAnswer = true;
        }

        function quizNext() {
            if (currentIdx < quizWords.length - 1) {
                currentIdx++;
                renderQuizCard(currentIdx);
            } else {
                document.getElementById('card-area').innerHTML = `
                  <div style="font-size:1.35rem;margin:70px 0 35px 0;text-align:center;color:#a16e0f;font-family:'Cafe24SsurroundAir','UhBee zzibae',sans-serif;">
                    Î™®Îì† ÌÄ¥Ï¶àÎ•º ÎßàÏ≥§Ïñ¥Ïöî!<br>ÏûòÌñàÏñ¥Ïöî üêªüç°
                  </div>
                  <button class="goto-home-btn" onclick="goHome()">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                `;
                document.getElementById('quiz-btn-group').style.display = "none";
                document.getElementById('quiz-result-msg').style.display = "none";
                setActiveHomeTab();
            }
        }
        window.quizCheckAnswer = quizCheckAnswer;

        function finishReview() {
            for(const w of reviewWords) {
                if (!allReviewedWords.some(x=>x.jp===w.jp)) allReviewedWords.push(w);
            }
            showResultMessage("Î≥µÏäµÍπåÏßÄ Î™®Îëê ÎÅùÎÇ¨Ïñ¥Ïöî! ÏûòÌñàÏñ¥Ïöî üêª‚ú®");
            finished = true;
            setActiveHomeTab();
        }

        // ÏöîÎØ∏Í∞ÄÎÇò ÌÜ†Í∏Ä: jp-wordÎ•º ÎàÑÎ•¥Î©¥ Î∞îÎ°ú ÏïÑÎûò .yomiganaÏóê show-yomigana ÌÅ¥ÎûòÏä§Î•º ÌÜ†Í∏Ä
        function toggleYomigana(wordElem) {
            const yomiganaElem = wordElem.nextElementSibling;
            if (!yomiganaElem) return;
            yomiganaElem.classList.toggle('show-yomigana');
        }
    </script>
</body>
</html>
